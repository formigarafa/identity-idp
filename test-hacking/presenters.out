
Randomized with seed 22820

TwoFactorAuthCode::PersonalKeyPresenter
  #fallback_question
    returns the fallback question
  #help_text
    returns blank

ImageUploadResponsePresenter
  #success?
    failure
      returns false
    success
      returns true
  #status
    limit error
      returns 429 too many requests
    success
      returns ok
    failure
      returns 400 bad request
  #errors
    success
      returns empty array
    failure
      returns formatted errors
  #as_json
    with form response as attention with barcode
      returns hash of properties
    throttled
      returns hash of properties
    error
      returns hash of properties
      hard fail
        returns hash of properties
      no remaining attempts
        returns hash of properties
    success
      returns hash of properties
  #remaining_attempts
    returns remaining attempts

TwoFactorAuthCode::MaxAttemptsReachedPresenter
  #type
    is expected to eq "otp_requests"
  #locked_reason
    returns locked reason
    with unsupported type
      raises error
  #decorated_user
    is expected to eq #<InstanceDouble(UserDecorator) (anonymous)>

TwoFactorAuthentication::VoiceSelectionPresenter
  #info
    when a user has a phone configuration
      includes the masked the number
  #disabled?
    is expected to eq false
    voice vendor outage
      is expected to eq true
  #type
    when a user has more than one phone configuration
      returns voice:id
    when a user has only one phone configuration
      returns voice

UtcTimePresenter
  #to_s
    returns the formatted timestamp in a string

TwoFactorOptionsPresenter
  #options
    supplies all the options for a user
    when hide_phone_mfa_signup is enabled
      supplies all the options except phone
    when platform_auth_set_up_enabled is enabled
      supplies all the options except webauthn
    when a phishing-resistant only SP is being used
      only displays phishing-resistant MFA methods

TwoFactorAuthCode::BackupCodePresenter
  #help_text
    returns blank
  #fallback_question
    returns the fallback question
  #cancel_link
    returns the link for cancellation
    returns a different link for cancellation if reauthn is true

AccountReset::PendingPresenter
  #account_reset_request
    returns the account reset request
  #time_remaining_until_granted
    when the remaining time is greater than 1 hour
      returns its description in hours and minutes
    when the remaining time is less than 1 minute
      returns its description in minutes and seconds
    when the remaining time is less than 1 second
      returns less than 1 second
    when the remaining time is less than 2 minutes
      returns its description in 1 minute and seconds
    when the remaining time is greater than 1 minute
      returns its description in minutes and seconds
    when the remaining time is less than 2 hours
      returns its description in 1 hour and minutes

TwoFactorAuthentication::AuthAppSelectionPresenter
  #mfa_configruation
    return an empty string when user has not configured this authenticator
    return an # added when user has configured this authenticator
  #type
    returns auth_app

CompletionsPresenter
  #intro
    ial2
      when consent has not expired
        renders the standard intro message
      consent has expired since the last sign in
        renders the expired IAL2 consent intro message
    ial1
      consent has expired since the last sign in
        renders the expired IAL1 consent intro message
      when consent has not expired
        renders the standard intro message
  #pii
    ial2
      with a subset of attributes requested
        properly scopes and resolve attributes
      with all attributes requested
        properly scopes and resolve attributes
    ial1
      with email and all_emails requested
        only displays all_emails
      with a subset of attributes requested
        properly scopes and resolve attributes
      with all attributes requested
        properly scopes and resolve attributes
  #image_name
    ial2 sign in
      renders the ial2 image
    ial1 sign in
      renders the ial1 image
  #heading
    consent has expired since the last sign in with ial1
      renders the expired consent message
    the user is signing into an SP for the first time
      renders the new sp message
    the sp has requested new attributes
      renders the new attributes message
    ial2 sign in
      renders the ial2 message
      renders the ial2 consent message if consent expired
        renders the expired consent message
    first time the user signs into any SP
      renders the first time sign in message

OpenidConnectCertsPresenter
  #certs
    renders the server public key as a JWK set

Idv::GpoPresenter
  #fallback_back_path
    when the user does not have a pending profile
      returns the idv phone path
    when the user has a pending profile
      returns the verify account path
  #title
    a letter has not been sent
      provides text to send
    a letter has been sent
      provides text to resend
  #button
    a letter has not been sent
      provides text to send
    a letter has been sent
      provides text to resend

TwoFactorAuthCode::GenericDeliveryPresenter
  is an abstract presenter with methods that should be implemented

Idv::CancellationsPresenter
  #exit_description
    returns exit description contents
    with associated sp
      returns exit description contents
  #exit_heading
    returns exit heading
    with associated sp
      returns exit heading
  #exit_action_text
    returns exit action text
    with associated sp
      returns exit action text

OpenidConnectConfigurationPresenter
  #configuration
    includes information about the OpenID Connect integration

TwoFactorLoginOptionsPresenter
  supplies a recovery options link when feature toggle is on
  supplies a reset link when the token is not valid
  supplies a title
  supplies a heading
  supplies a cancel link when the token is valid
  #first_enabled_option_index
    returns first index
    enabled options
      returns first enabled index
    disabled options
      returns first enabled index
  with multiple webauthn configurations
    has only one webauthn selection presenter
  #cancel_link
    reauthentication user session context
      is expected to eq "/account"
    default user session context
      is expected to eq "/sign_out"

TwoFactorAuthentication::SmsSelectionPresenter
  #type
    when a user has more than one phone configuration
      returns sms:id
    when a user has only one phone configuration
      returns sms
  #disabled?
    is expected to eq false
    sms vendor outage
      is expected to eq true
  #info
    when a user has a phone configuration
      includes the masked the number

OpenidConnectUserInfoPresenter
  #user_info
    has basic attributes
    when there is decrypted ial2 session data in redis
      when the identity has ial2 access
        verified_at
          when the service provider has ial2 access
            provides verified_at
          when the service provider has ial1 access
            does not provide verified_at
        when the scope includes all attributes
          returns ial2 attributes
          renders values as simple strings as json
        when the scope only includes minimal attributes
          returns attributes allowed by the scope
      when the identity only has ial1 access
        does not return ial2 attributes
    when a piv/cac was used as second factor
      when the identity has no piv/cac associated
        when the scope includes all attributes
          returns no x509 attributes
      when the identity has piv/cac associated
        when the scope includes all attributes
          returns x509 attributes
          renders values as simple strings as json

TwoFactorAuthentication::PersonalKeySelectionPresenter
  #type
    returns personal_key

AdditionalMfaRequiredPresenter
  #info
    when its after enforcement date
      supplies proper info
    when its before enforcement date
      supplies proper info
  #title
    when its after enforcement date
      supplies proper title
    when its before enforcement date
      supplies proper title
  #skip
    when its before enforcement date
      supplies proper skip text
    when its after enforcement date
      supplies proper skip text
  #cant_skip_anymore?
    when its after enforcement date
      when user doesnt have attribute set
        should return false
      when users have attribute set
        should return true
    when its before enforcement date
      should return false

TwoFactorAuthCode::PhoneDeliveryPresenter
  is a subclass of GenericDeliveryPresenter
  #cancel_link
    returns the account path during phone change confirmation
    returns the sign out path during authentication
    returns the account path during reauthn
  #phone_number_message
    specifies when the code will expire

RiscConfigurationPresenter
  #configuration
    includes information about the RISC integration

SetupPresenter
  shows correct value for remember device
    shows false for cookie: nil, default value: false
    shows true for cookie: true, default value: true
    shows true for cookie: true, default value: false
    shows false for cookie: nil, default value: true

FullySignedInModalPresenter
  #sign_out
    uses the fully signed in localization
  #continue
    uses the fully signed in localization
  #message
    returns the fully signed in message
  #sr_message
    returns the fully signed in message for screen readers

TwoFactorAuthCode::PivCacAuthenticationPresenter
  #piv_cac_capture_text
    is expected to eq "Present PIV/CAC card"
  #cancel_link
    not reauthn
      returns the sign out path
    reauthn
      returns the account path
  #header
    is expected to eq "Present your PIV/CAC"
  #link_text
    with multiple phishing-resistant methods
      supplies link text
    with only one phishing-resistant method do
      supplies no link text
  help_text
    supplies no help text
  #piv_cac_help
    returns help text
    with PIV/CAC only requested
      with a user who has a PIV and security key
        returns the PIV only help text
      with a user who only has a PIV
        returns the PIV only help text
    with phishing-resistant requested
      with a user who has a PIV and security key
        returns the PIV or phishing-resistant help text
      with a user who only has a PIV
        returns the PIV only help text
  #fallback_question
    when the user can switch to a different method
      returns a question about switching methods
    when the user cannot switch to a different method
      returns an empty string

TwoFactorAuthCode::AuthenticatorDeliveryPresenter
  handles multiple locales
  #fallback_question
    supplies a fallback_question
  #header
    supplies a header

PivCacAuthenticationSetupPresenter
  #title
    is expected to eq "Use your PIV/CAC card to secure your account"
  #heading
    is expected to eq "Use your PIV/CAC card to secure your account"
  #description
    is expected to eq "We’ll ask you to present your PIV/CAC card <strong>each time you sign in</strong> as part of two-fac... “Add PIV/CAC” your browser will prompt you for your PIV/CAC PIN and have you select a certificate."

NavigationPresenter
  #navigation_items
    personal key
      for a user with a personal key
        has a link to reset personal key
      for a user that does not have a personal key
        does not link to reset personal key
      for a proofed user with deactivated profile due to password reset
        does not have a link to reset personal key

PivCacErrorPresenter
  #heading
    is expected to eq "We cannot detect a certificate on your PIV/CAC card"
  #description
    is expected to eq "Please make sure your PIV/CAC is connected and . If this problem continues, contact your agency administrator."
  #title
    is expected to eq "We cannot detect a certificate on your PIV/CAC card"
  #error
    reflects the form

Idv::InPerson::VerificationResultsEmailPresenter
  #service_provider
    returns service provider associated with enrollment
  #service_provider_homepage_url
    without service provider
      returns nil
    with service provider
      with homepage_url
        returns homepage url
      without homepage_url
        returns root url
  #location_name
    returns the enrollment location name
  #formatted_verified_date
    returns a formatted verified date
  #sign_in_url
    without service provider
      returns root url
    with service provider
      with homepage_url
        returns homepage url
      without homepage_url
        returns root url
  #service_provider_or_app_name
    without service provider
      returns app name
    with service provider
      returns friendly name of service provider
  #show_cta?
    without service provider
      is expected to eq true
    with service provider
      with homepage_url
        is expected to eq true
      without homepage_url
        is expected to eq false

AccountShowPresenter
  #header_personalization
    AccountShowPresenter instance has decrypted_pii
      returns the user's first name
    AccountShowPresenter instance does not have decrypted_pii
      returns the email the user used to sign in last
  #personal_key_generated_at
    the user has no encrypted_recovery_code_digest_generated_at and is not proofed
      returns nil
    the user has a encrypted_recovery_code_digest_generated_at date
      returns the date in the digest
    the user does not have a encrypted_recovery_code_digest_generated_at but is proofed
      returns the date the user was proofed
  #pii
    birthday is formatted as an international date
      parses the birthday
    birthday is formatted as an american date
      parses the birthday
  #backup_codes_generated_at
    returns nil if there are not backup codes
    returns the created_at date of the oldest backup code
  #totp_content
    user does not have an authenticator app enabled
      returns localization for auth_app_disabled
    user has enabled an authenticator app
      returns localization for auth_app_enabled

TwoFactorAuthentication::PhoneSelectionPresenter
  #disabled?
    is expected to eq false
    all phone vendor outage
      is expected to eq true
  #mfa_configuration
    returns an # added when user has configured this authenticator
    does not include a note to select an additional mfa on additional setup
    includes a note to select an additional mfa method on first setup
    returns an empty string when user has not configured this authenticator
  #info
    when a user does not have a phone configuration (first time)
      does not include a masked number
      includes a note about choosing voice or sms

TwoFactorAuthentication::PivCacSelectionPresenter
  #type
    returns piv_cac
  #mfa_configruation
    returns an # added when user has configured this authenticator
    returns an empty string when user has not configured this authenticator

TwoFactorAuthentication::WebauthnPlatformSelectionPresenter
  #mfa_configruation
    returns an empty string when user has not configured this authenticator
    returns an # added when user has configured this authenticator
  #html_class
    returns display-none
  #type
    returns webauthn_platform

TwoFactorAuthentication::SelectionPresenter
  #label
    with configuration
      raises with missing translation
    with no configuration
      raises with missing translation
  #disabled?
    is expected to eq false
  #info
    with no configuration
      raises with missing translation
    with configuration
      raises with missing translation

TwoFactorAuthCode::WebauthnAuthenticationPresenter
  handles multiple locales
  #help_text
    supplies no help text
  #cancel_link
    not reauthn
      returns the sign out path
    reauthn
      returns the account path
  #multiple_factors_enabled?
    with multiple factors enabled in user policy
      returns true
    with multiple factors not enabled for user policy
      returns false
  #webauthn_help
    with phishing-resistant required
      the user has a security key and PIV enabled
        returns the help text for the security key or PIV
      the user only has a security key enabled
        returns the help text for just the security key
    with phishing-resistant not required
      displays the help text
    with a platform authenticator
      returns the help text for a platform authenticator
  #verified_info_text
    with a platform authenticator
      renders the platform authenticator text
    with a roaming authenticator
      renders the roaming authenticator text
  #verified_header
    with a platform authenticator
      renders the platform authenticator header
    with a roaming authenticator
      renders the roaming authenticator header
  #link_text
    with only one phishing-resistant method do
      supplies no link text
    with multiple phishing-resistant methods
      supplies link text
  #authenticate_button_text
    with a platform authenticator
      renders the platform authenticator button text
    with a roaming authenticator
      renders the roaming authenticator button text
  #fallback_question
    supplies a fallback_question
  #header
    with a platform authenticator
      renders the platform authenticator header
    with a roaming authenticator
      renders the roaming authenticator header

Idv::InPerson::ReadyToVerifyPresenter
  #sp_name
    returns friendly service provider name
  #selected_location_hours
    returns localized location hours for weekdays and weekends by prefix
    with Spanish locale
      returns localized location hours for weekdays and weekends by prefix
  #days_remaining
    4 days until due date
      returns 3 days
  #barcode_image_url
    is expected to be nil
    with barcode url
      returns barcode url
  #needs_proof_of_address?
    with current address not matching id
      is expected to eq true
    with current address matching id
      is expected to eq false
  #selected_location_details
    returns a hash of location details associated with the enrollment
    with blank selected_location_details
      returns nil
  #formatted_due_date
    returns a formatted due date
    there is no enrollment_established_at
      returns formatted due date when no enrollment_established_at

SamlRequestPresenter
  #requested_attributes
    IAL2 and bundle contains invalid attributes
      only returns valid attributes named per the OpenId Connect spec
    with no requested context and IAL1 SP
      returns permitted attribute_bundle
    IAL1 and bundle contains invalid attributes and IAL2 attributes
      only returns :email
    with no requested context and IAL2 SP
      returns SP attribute_bundle
    IAL2 and bundle contains multiple address attributes
      consolidates address attributes into one :address attribute

MfaConfirmationPresenter
  #button?
    supplies a message
  #info?
    supplies a message
  #heading?
    supplies a message

EasternTimePresenter
  #to_s
    returns the formatted timestamp in a string

ConfirmDeleteEmailPresenter
  #confirm_delete_message
    supplies a message for confirm delete page

PartiallySignedInModalPresenter
  #sign_out
    uses the partially signed in localization
  #sr_message
    returns the partially signed in message for screen readers
  #message
    returns the partially signed in message
  #continue
    uses the partially signed in localization

TwoFactorAuthentication::WebauthnSelectionPresenter
  #type
    returns webauthn
  #mfa_configruation
    returns an empty string when user has not configured this authenticator
    returns an # added when user has configured this authenticator
  #html_class
    returns display-none

CancellationPresenter
  #go_back_link
    with a referer header with query params
      returns the path with the query params
    with a referer header with a javascript scheme
      returns the sign_up_path
    without a referer header
      returns the sign_up_path
    with a referer header for a different domain
      returns the sign_up_path
    with a referer header
      returns the path

WebauthnSetupPresenter
  #intro_html
    is expected to eq "<p>Add a security key that meets the FIDO standard as your authentication method. You can add as many security keys as you want. To get started, first give your security key a nickname.</p>"
  #button_text
    is expected to eq "Continue"
  #heading
    is expected to eq "Add your security key"
  with platform_authenticator
    #nickname_label
      is expected to eq "Device nickname"
    #button_text
      is expected to eq "Continue"
    #setup_heading
      is expected to eq "Use Touch or Face Unlock to access your account."
    #heading
      is expected to eq "Use your device"
    #image_path
      is expected to eq "platform-authenticator.svg"
  #intro_link
    is expected to include "https://www.login.gov/help/get-started/authentication-options/"
    is expected to include "Learn more about face or touch unlock."
  #nickname_label
    is expected to eq "Security key nickname"
  #image_path
    is expected to eq "security-key.svg"
  #setup_heading
    is expected to eq "Connect your security key"

Top 10 slowest examples (1.67 seconds, 8.7% of total time):
  CompletionsPresenter#pii ial2 with a subset of attributes requested properly scopes and resolve attributes
    0.23496 seconds ./spec/presenters/completions_presenter_spec.rb:286
  CompletionsPresenter#heading the user is signing into an SP for the first time renders the new sp message
    0.19794 seconds ./spec/presenters/completions_presenter_spec.rb:143
  OpenidConnectUserInfoPresenter#user_info when there is decrypted ial2 session data in redis when the identity has ial2 access when the scope only includes minimal attributes returns attributes allowed by the scope
    0.17087 seconds ./spec/presenters/openid_connect_user_info_presenter_spec.rb:140
  TwoFactorLoginOptionsPresenter#first_enabled_option_index enabled options returns first enabled index
    0.16002 seconds ./spec/presenters/two_factor_login_options_presenter_spec.rb:123
  CompletionsPresenter#image_name ial1 sign in renders the ial1 image
    0.15298 seconds ./spec/presenters/completions_presenter_spec.rb:161
  OpenidConnectUserInfoPresenter#user_info when there is decrypted ial2 session data in redis when the identity has ial2 access when the scope includes all attributes returns ial2 attributes
    0.15288 seconds ./spec/presenters/openid_connect_user_info_presenter_spec.rb:111
  OpenidConnectUserInfoPresenter#user_info when there is decrypted ial2 session data in redis when the identity has ial2 access verified_at when the service provider has ial1 access does not provide verified_at
    0.15105 seconds ./spec/presenters/openid_connect_user_info_presenter_spec.rb:162
  OpenidConnectUserInfoPresenter#user_info has basic attributes
    0.14999 seconds ./spec/presenters/openid_connect_user_info_presenter_spec.rb:28
  Idv::InPerson::ReadyToVerifyPresenter#formatted_due_date returns a formatted due date
    0.14779 seconds ./spec/presenters/idv/in_person/ready_to_verify_presenter_spec.rb:34
  Idv::InPerson::VerificationResultsEmailPresenter#sign_in_url with service provider with homepage_url returns homepage url
    0.14778 seconds ./spec/presenters/idv/in_person/verification_results_email_presenter_spec.rb:122

Top 10 slowest example groups:
  OpenidConnectUserInfoPresenter
    0.13691 seconds average (1.37 seconds / 10 examples) ./spec/presenters/openid_connect_user_info_presenter_spec.rb:3
  CompletionsPresenter
    0.122 seconds average (2.07 seconds / 17 examples) ./spec/presenters/completions_presenter_spec.rb:3
  Idv::InPerson::ReadyToVerifyPresenter
    0.11477 seconds average (1.38 seconds / 12 examples) ./spec/presenters/idv/in_person/ready_to_verify_presenter_spec.rb:3
  Idv::InPerson::VerificationResultsEmailPresenter
    0.10372 seconds average (1.45 seconds / 14 examples) ./spec/presenters/idv/in_person/verification_results_email_presenter_spec.rb:3
  TwoFactorAuthentication::PivCacSelectionPresenter
    0.09441 seconds average (0.28323 seconds / 3 examples) ./spec/presenters/two_factor_authentication/piv_cac_selection_presenter_spec.rb:3
  Idv::GpoPresenter
    0.09252 seconds average (0.55514 seconds / 6 examples) ./spec/presenters/idv/gpo_presenter_spec.rb:3
  TwoFactorAuthCode::PersonalKeyPresenter
    0.09088 seconds average (0.18175 seconds / 2 examples) ./spec/presenters/two_factor_auth_code/personal_key_presenter_spec.rb:3
  NavigationPresenter
    0.08947 seconds average (0.26842 seconds / 3 examples) ./spec/presenters/navigation_presenter_spec.rb:3
  AdditionalMfaRequiredPresenter
    0.08728 seconds average (0.78548 seconds / 9 examples) ./spec/presenters/additional_mfa_required_presenter_spec.rb:3
  MfaConfirmationPresenter
    0.08438 seconds average (0.25315 seconds / 3 examples) ./spec/presenters/mfa_confirmation_presenter_spec.rb:3

Finished in 19.11 seconds (files took 1.11 seconds to load)
267 examples, 0 failures

Randomized with seed 22820

Coverage report generated for RSpec to /home/jmax/projects/identity-idp/coverage. 4043 / 34859 LOC (11.6%) covered.


Randomized with seed 5722

MfaPolicy
  no mfa configurations
    is expected to eq false
    is expected to eq false
  one mfa configuration
    is expected to eq true
    is expected to eq false
  two mfa configuration
    is expected to eq true
    is expected to eq true
  #unphishable?
    with phishable configuration
      is expected to eq false
    with unphishable configuration
      is expected to eq true
  #multiple_non_restricted_factors_enabled?
    with multi mfa enabled returns false
      is expected to eq false
  #multiple_non_restricted_factors_enabled?
    with multi mfa disabled returns true
      is expected to eq true

ServiceProviderMfaPolicy
  #auth_method_confirms_to_sp_request?
    the user has not setup the required MFA
      is expected to eq false
    there are no MFA requirements
      is expected to eq true
    the user used the required MFA
      is expected to eq true
    the user did not use the required MFA
      is expected to eq false
  #user_needs_sp_auth_method_verification?
    piv/cac required
      the user needs to setup a PIV
        is expected to eq false
      the user used PIV/CAC
        is expected to eq false
      the user used webauthn
        is expected to eq true
      the user did not use an AAL3 method
        is expected to eq true
    no MFA requirements
      is expected to eq false
    aal3 required
      the user used PIV/CAC
        is expected to eq false
      the user used webauthn
        is expected to eq false
      the user did not use an AAL3 method
        is expected to eq true
      the user needs to setup an AAL3 method
        is expected to eq false
  #allow_user_to_switch_method?
    there are no MFA reqirements
      is expected to eq true
    phishing-resistant required
      the user does not have more than one aal3 method
        is expected to eq false
      the user has more than one phishing-resistant method
        is expected to eq true
    piv/cac required
      the user has a PIV
        is expected to eq false
      the user does not have a PIV
        is expected to eq false
      the user has a PIV and webauthn token
        is expected to eq false
  #user_needs_sp_auth_method_setup?
    aal3 required
      the user has webauthn configured
        is expected to eq false
      the user has PIV/CAC configured
        is expected to eq false
      the user does not have an AAL3 method configured
        is expected to eq true
    no MFA requirements
      is expected to eq false
    piv/cac required
      the user does not have an AAL3 method configured
        is expected to eq true
      the user has webauthn configured
        is expected to eq true
      the user has PIV/CAC configured
        is expected to eq false
  #phishing_resistant_required?
    no aal level requested, SP default is aal3
      is expected to eq true
    AAL 3 requested
      is expected to eq true
    aal2 level requested, SP default is aal3
      is expected to eq false
    phishing-resistant requested
      is expected to eq true
    aal2 requested, no default set
      is expected to eq false

TwoFactorAuthentication::PivCacPolicy
  #configured?
    without a piv configured
      is expected to be falsey
    with a piv configured
      is expected to be truthy
  #enabled?
    without a piv configured
      is expected to be falsey
    with a piv configured
      is expected to be truthy

TwoFactorAuthentication::WebauthnPolicy
  #configured?
    without a webauthn configured
      is expected to be falsey
    with a webauthn configured
      returns a truthy value
  #roaming_enabled?
    with a roaming webauthn configured
      returns a truthy value
    without a webauthn configured
      is expected to be falsey

TwoFactorAuthentication::BackupCodePolicy
  #configured?
    returns true if there are usable codes
    returns false if all the backup codes are used
    returns false if there are no codes

Top 10 slowest examples (1.63 seconds, 24.6% of total time):
  MfaPolicy no mfa configurations is expected to eq false
    0.36498 seconds ./spec/policies/user_mfa_policy_spec.rb:9
  ServiceProviderMfaPolicy#user_needs_sp_auth_method_verification? aal3 required the user did not use an AAL3 method is expected to eq true
    0.2364 seconds ./spec/policies/service_provider_mfa_policy_spec.rb:93
  ServiceProviderMfaPolicy#allow_user_to_switch_method? piv/cac required the user does not have a PIV is expected to eq false
    0.14131 seconds ./spec/policies/service_provider_mfa_policy_spec.rb:279
  ServiceProviderMfaPolicy#user_needs_sp_auth_method_verification? aal3 required the user used webauthn is expected to eq false
    0.13894 seconds ./spec/policies/service_provider_mfa_policy_spec.rb:82
  ServiceProviderMfaPolicy#allow_user_to_switch_method? phishing-resistant required the user has more than one phishing-resistant method is expected to eq true
    0.13499 seconds ./spec/policies/service_provider_mfa_policy_spec.rb:254
  ServiceProviderMfaPolicy#user_needs_sp_auth_method_verification? aal3 required the user used PIV/CAC is expected to eq false
    0.1319 seconds ./spec/policies/service_provider_mfa_policy_spec.rb:74
  ServiceProviderMfaPolicy#user_needs_sp_auth_method_verification? piv/cac required the user did not use an AAL3 method is expected to eq true
    0.12229 seconds ./spec/policies/service_provider_mfa_policy_spec.rb:134
  ServiceProviderMfaPolicy#auth_method_confirms_to_sp_request? the user did not use the required MFA is expected to eq false
    0.12063 seconds ./spec/policies/service_provider_mfa_policy_spec.rb:222
  ServiceProviderMfaPolicy#auth_method_confirms_to_sp_request? the user used the required MFA is expected to eq true
    0.11883 seconds ./spec/policies/service_provider_mfa_policy_spec.rb:210
  ServiceProviderMfaPolicy#user_needs_sp_auth_method_verification? no MFA requirements is expected to eq false
    0.11715 seconds ./spec/policies/service_provider_mfa_policy_spec.rb:143

Top 5 slowest example groups:
  ServiceProviderMfaPolicy
    0.11535 seconds average (3.58 seconds / 31 examples) ./spec/policies/service_provider_mfa_policy_spec.rb:3
  MfaPolicy
    0.11257 seconds average (1.13 seconds / 10 examples) ./spec/policies/user_mfa_policy_spec.rb:3
  TwoFactorAuthentication::WebauthnPolicy
    0.06962 seconds average (0.27849 seconds / 4 examples) ./spec/policies/webauthn_login_option_policy_spec.rb:3
  TwoFactorAuthentication::PivCacPolicy
    0.06858 seconds average (0.27431 seconds / 4 examples) ./spec/policies/two_factor_authentication/piv_cac_policy_spec.rb:3
  TwoFactorAuthentication::BackupCodePolicy
    0.06736 seconds average (0.20208 seconds / 3 examples) ./spec/policies/backup_code_policy_spec.rb:3

Finished in 6.62 seconds (files took 4.99 seconds to load)
52 examples, 0 failures

Randomized with seed 5722

Coverage report generated for RSpec to /home/jmax/projects/identity-idp/coverage. 2176 / 36640 LOC (5.94%) covered.
